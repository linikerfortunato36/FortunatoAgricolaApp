<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-3">
        <div>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-1">
                    <li class="breadcrumb-item"><a routerLink="/app/transportadoras"
                            class="text-decoration-none">Transportadoras</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Adição / Detalhes de Logística</li>
                </ol>
            </nav>
            <h2 class="h3 fw-bold text-dark mb-0">Gestão de Transportadora</h2>
        </div>
        <div>
            <button routerLink="/app/transportadoras" class="btn btn-outline-secondary me-2" [disabled]="submitting"><i
                    class="bi bi-x-circle me-1"></i> Cancelar</button>
            <button class="btn btn-primary" (click)="onSubmit()" [disabled]="submitting">
                <span *ngIf="submitting" class="spinner-border spinner-border-sm me-2"></span>
                <i *ngIf="!submitting" class="bi bi-floppy me-1"></i> Salvar
            </button>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <!-- Tabs exigidas na rega de negócio -->
            <ul class="nav nav-tabs mb-4 border-bottom-0" id="transpTab" role="tablist">
                <!-- 1 Aba: Resumo Logístico (Invisível para Novos Registros) -->
                <li class="nav-item d-none" role="presentation">
                    <button class="nav-link text-dark shadow-sm bg-white border border-bottom-0 rounded-top"
                        id="logistica-tab" data-bs-toggle="tab" data-bs-target="#logistica" type="button" role="tab"
                        aria-controls="logistica" aria-selected="false">
                        <i class="bi bi-map me-2 text-primary"></i> Visão Logística
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link active text-primary fw-bold border-bottom-0 rounded-top shadow-sm bg-white"
                        id="edicao-tab" data-bs-toggle="tab" data-bs-target="#edicao" type="button" role="tab"
                        aria-controls="edicao" aria-selected="true">
                        <i class="bi bi-card-checklist me-2"></i> Cadastro da Transportadora
                    </button>
                </li>
            </ul>

            <div class="tab-content border bg-white shadow-sm rounded-bottom rounded-end mb-4" id="transpTabContent">
                <!-- FIRST TAB: Painel Logístico Oculto em novo registro -->
                <div class="tab-pane fade" id="logistica" role="tabpanel" aria-labelledby="logistica-tab">
                    <div class="p-4" style="background-color: var(--bg-color);">
                        <h5 class="fw-bold mb-3"><i class="bi bi-bar-chart-fill text-primary"></i> Resumo de Fretes e
                            Entregas</h5>
                        <div class="row g-3 mb-4">
                            <div class="col-md-3">
                                <div class="card border-0 shadow-sm h-100 bg-primary text-white">
                                    <div class="card-body">
                                        <h6 class="text-uppercase opacity-75 fw-bold small">Viagens Totais</h6>
                                        <h4 class="fw-bold">402</h4>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card border-0 shadow-sm h-100">
                                    <div class="card-body">
                                        <h6 class="text-uppercase text-muted fw-bold small">Gasto Estimado (Frete)</h6>
                                        <h5 class="fw-bold text-danger">R$ 145.000,00</h5>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tabela de Movimentos Filtráveis da Transportadora -->
                        <div class="card border-0 shadow-sm mt-2">
                            <div
                                class="card-header bg-white border-bottom pt-3 pb-2 d-flex justify-content-between align-items-center">
                                <h6 class="fw-bold mb-0">Histórico de Transportes Oficiais</h6>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover align-middle mb-0 text-center text-nowrap small">
                                        <thead class="bg-light text-muted">
                                            <tr>
                                                <th class="ps-3 text-start">DATA</th>
                                                <th class="text-start">CONTRATO Associado</th>
                                                <th>MOTORISTA (veículo)</th>
                                                <th>P. ORIGEM (KG)</th>
                                                <th class="text-primary fw-bold">P. DESTINO (KG)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td class="ps-3 text-start">28/02/2026</td>
                                                <td class="text-start"><span class="badge bg-secondary">001/26</span>
                                                    Cargill</td>
                                                <td class="text-muted">João (ABC-1234)</td>
                                                <td>31.000</td>
                                                <td class="text-primary fw-bold bg-light fs-6">30.150</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECOND TAB: Cadastro -->
                <div class="tab-pane fade show active" id="edicao" role="tabpanel" aria-labelledby="edicao-tab">
                    <form class="p-4">
                        <div class="row g-4">
                            <div class="col-md-6">
                                <label class="form-label fw-bold text-dark">Razão Social / Nome da Transportadora
                                    *</label>
                                <input type="text" class="form-control" [(ngModel)]="transportadora.nome" name="nome"
                                    placeholder="Expresso Safra LTDA" required>
                            </div>

                            <div class="col-md-4">
                                <label class="form-label fw-bold text-dark">CNPJ / CPF *</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" [(ngModel)]="transportadora.cpfCnpj"
                                        name="cpfCnpj" placeholder="00.000.000/0001-00" required (blur)="buscarCnpj()">
                                    <span class="input-group-text" *ngIf="cnpjCarregando">
                                        <span class="spinner-border spinner-border-sm text-success"></span>
                                    </span>
                                    <span class="input-group-text text-success"
                                        *ngIf="!cnpjCarregando && !cnpjErro && transportadora.nome">
                                        <i class="bi bi-check-circle-fill"></i>
                                    </span>
                                </div>
                                <div *ngIf="cnpjErro" class="text-danger small mt-1">
                                    <i class="bi bi-exclamation-circle me-1"></i>{{ cnpjErro }}
                                </div>
                                <div *ngIf="cnpjCarregando" class="text-muted small mt-1">
                                    <i class="bi bi-search me-1"></i>Consultando CNPJ na Receita Federal...
                                </div>
                            </div>

                            <div class="col-md-2">
                                <label class="form-label fw-bold text-dark">Insc. Estadual</label>
                                <input type="text" class="form-control" [(ngModel)]="transportadora.inscricaoEstadual"
                                    name="inscricaoEstadual" placeholder="ISENTO">
                            </div>

                            <div class="col-12 mt-4">
                                <h5 class="fw-bold border-bottom pb-2 mt-2">Localização Sede</h5>
                            </div>

                            <div class="col-md-3">
                                <label class="form-label fw-bold text-dark">CEP</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" [(ngModel)]="transportadora.cep" name="cep">
                                    <button class="btn btn-outline-secondary" type="button"><i
                                            class="bi bi-search"></i></button>
                                </div>
                            </div>

                            <div class="col-md-7">
                                <label class="form-label fw-bold text-dark">Rua / Logradouro</label>
                                <input type="text" class="form-control" [(ngModel)]="transportadora.logradouro"
                                    name="logradouro">
                            </div>

                            <div class="col-md-2">
                                <label class="form-label fw-bold text-dark">UF</label>
                                <select class="form-select" [(ngModel)]="transportadora.estado" name="estado">
                                    <option value="MT">MT</option>
                                    <option value="PR">PR</option>
                                    <option value="SP">SP</option>
                                    <option value="GO">GO</option>
                                    <option value="MS">MS</option>
                                </select>
                            </div>

                            <div class="col-12 mt-4">
                                <div class="form-check form-switch fs-5">
                                    <input class="form-check-input" type="checkbox" id="ativoTransp"
                                        [(ngModel)]="transportadora.isActive" name="isActive">
                                    <label class="form-check-label ms-2 text-dark fs-6 mt-1"
                                        for="ativoTransp">Transportadora Ativa no Sistema</label>
                                </div>
                            </div>

                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>